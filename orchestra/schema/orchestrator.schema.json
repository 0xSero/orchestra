{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OpenCode Orchestrator Config",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": { "type": "string" },
    "basePort": { "type": "number", "default": 14096 },
    "autoSpawn": { "type": "boolean", "default": true },
    "spawnOnDemand": {
      "type": "array",
      "items": { "type": "string" },
      "default": ["vision"],
      "description": "Worker IDs allowed to auto-spawn when needed (e.g. vision analysis)."
    },
    "spawnPolicy": {
      "type": "object",
      "additionalProperties": false,
      "description": "Per-profile spawn controls (auto, on-demand, manual, warm pool, reuse).",
      "properties": {
        "default": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "autoSpawn": { "type": "boolean" },
            "onDemand": { "type": "boolean" },
            "allowManual": { "type": "boolean" },
            "warmPool": { "type": "boolean" },
            "reuseExisting": { "type": "boolean" }
          }
        },
        "profiles": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "autoSpawn": { "type": "boolean" },
              "onDemand": { "type": "boolean" },
              "allowManual": { "type": "boolean" },
              "warmPool": { "type": "boolean" },
              "reuseExisting": { "type": "boolean" }
            }
          }
        }
      }
    },
    "startupTimeout": { "type": "number", "default": 30000 },
    "healthCheckInterval": { "type": "number", "default": 30000 },
    "healthCheck": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "intervalMs": { "type": "number", "default": 30000, "minimum": 10000 },
        "timeoutMs": { "type": "number", "default": 3000 },
        "maxRetries": { "type": "number", "default": 3 }
      }
    },
    "warmPool": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "profiles": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "size": { "type": "number", "minimum": 0 },
              "idleTimeoutMs": { "type": "number", "minimum": 0 }
            }
          }
        }
      }
    },
    "modelSelection": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "mode": { "enum": ["performance", "balanced", "economical"], "default": "performance" },
        "maxCostPer1kTokens": { "type": "number" },
        "preferredProviders": { "type": "array", "items": { "type": "string" } }
      }
    },
    "modelAliases": {
      "type": "object",
      "additionalProperties": { "type": "string" }
    },
    "ui": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "toasts": { "type": "boolean", "default": true },
        "injectSystemContext": { "type": "boolean", "default": true },
        "systemContextMaxWorkers": { "type": "number", "default": 12 },
        "defaultListFormat": { "type": "string", "enum": ["markdown", "json"], "default": "markdown" },
        "debug": { "type": "boolean", "default": false },
        "logToConsole": { "type": "boolean", "default": false },
        "firstRunDemo": { "type": "boolean", "default": true },
        "wakeupInjection": {
          "type": "boolean",
          "default": true,
          "description": "When async worker jobs or vision analysis complete, inject a prompt into the orchestrator session to resume it."
        }
      }
    },
    "notifications": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "idle": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "title": { "type": "string" },
            "message": { "type": "string" },
            "delayMs": { "type": "number", "default": 1500 }
          }
        }
      }
    },
    "agent": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "name": { "type": "string", "default": "orchestrator" },
        "model": { "type": "string" },
        "prompt": { "type": "string" },
        "mode": { "type": "string", "enum": ["primary", "subagent"], "default": "primary" },
        "color": { "type": "string" },
        "applyToBuild": { "type": "boolean" }
      }
    },
    "commands": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "prefix": { "type": "string", "default": "orchestrator." }
      }
    },
    "pruning": {
      "type": "object",
      "additionalProperties": false,
      "description": "DCP-inspired context pruning (truncates large tool inputs/outputs before sending to the LLM).",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "maxToolOutputChars": { "type": "number", "default": 12000 },
        "maxToolInputChars": { "type": "number", "default": 4000 },
        "protectedTools": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["task", "todowrite", "todoread"]
        }
      }
    },
    "workflows": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "roocodeBoomerang": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "steps": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["id"],
                "properties": {
                  "id": { "type": "string" },
                  "title": { "type": "string" },
                  "workerId": { "type": "string" },
                  "prompt": { "type": "string" },
                  "carry": { "type": "boolean" }
                }
              }
            },
            "maxSteps": { "type": "number", "default": 4 },
            "maxTaskChars": { "type": "number", "default": 12000 },
            "maxCarryChars": { "type": "number", "default": 24000 },
            "perStepTimeoutMs": { "type": "number", "default": 120000 }
          }
        }
      }
    },
    "security": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "workflows": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxSteps": { "type": "number", "default": 4 },
            "maxTaskChars": { "type": "number", "default": 12000 },
            "maxCarryChars": { "type": "number", "default": 24000 },
            "perStepTimeoutMs": { "type": "number", "default": 120000 }
          }
        }
      }
    },
    "memory": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "autoSpawn": { "type": "boolean", "default": true },
        "autoRecord": { "type": "boolean", "default": true },
        "autoInject": { "type": "boolean", "default": true },
        "scope": { "type": "string", "enum": ["project", "global"], "default": "project" },
        "maxChars": { "type": "number", "default": 2000 },
        "summaries": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "sessionMaxChars": { "type": "number", "default": 2000 },
            "projectMaxChars": { "type": "number", "default": 2000 }
          }
        },
        "trim": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxMessagesPerSession": { "type": "number", "default": 60 },
            "maxMessagesPerProject": { "type": "number", "default": 400 },
            "maxMessagesGlobal": { "type": "number", "default": 2000 },
            "maxProjectsGlobal": { "type": "number", "default": 25 }
          }
        },
        "inject": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxChars": { "type": "number", "default": 2000 },
            "maxEntries": { "type": "number", "default": 8 },
            "includeMessages": { "type": "boolean", "default": false },
            "includeSessionSummary": { "type": "boolean", "default": true },
            "includeProjectSummary": { "type": "boolean", "default": true },
            "includeGlobal": { "type": "boolean", "default": true },
            "maxGlobalEntries": { "type": "number", "default": 3 }
          }
        }
      }
    },
    "integrations": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "linear": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "apiKey": { "type": "string" },
            "teamId": { "type": "string" },
            "apiUrl": { "type": "string" },
            "projectPrefix": { "type": "string" }
          }
        },
        "neo4j": {
          "type": "object",
          "additionalProperties": false,
          "description": "Neo4j connection for memory graph. Can also use env vars: OPENCODE_NEO4J_URI, OPENCODE_NEO4J_USERNAME, OPENCODE_NEO4J_PASSWORD, OPENCODE_NEO4J_DATABASE. Env vars take priority over config file settings.",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable Neo4j memory backend. When disabled or not configured, file-based memory is used."
            },
            "uri": {
              "type": "string",
              "description": "Neo4j connection URI (e.g. 'bolt://localhost:7687' or 'neo4j+s://xxx.databases.neo4j.io')"
            },
            "username": { "type": "string", "description": "Neo4j username (typically 'neo4j')" },
            "password": { "type": "string", "description": "Neo4j password" },
            "database": {
              "type": "string",
              "description": "Neo4j database name (optional, uses default if not specified)"
            },
            "autoStart": {
              "type": "boolean",
              "default": true,
              "description": "Automatically start Neo4j Docker container if not running (requires Docker)"
            },
            "image": {
              "type": "string",
              "default": "neo4j:community",
              "description": "Docker image to use for Neo4j container"
            }
          }
        },
        "monitoring": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "port": { "type": "number" },
            "metricsPath": { "type": "string" }
          }
        }
      }
    },
    "telemetry": {
      "type": "object",
      "additionalProperties": false,
      "description": "PostHog telemetry settings. Set POSTHOG_API_KEY env var or provide apiKey here.",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "apiKey": { "type": "string", "description": "PostHog API key (or use POSTHOG_API_KEY env var)" },
        "host": { "type": "string", "description": "PostHog host (default: https://us.i.posthog.com)" }
      }
    },
    "profiles": {
      "type": "array",
      "description": "Profiles available to spawn. Use this to set workerâ†’model mapping without auto-spawning.",
      "items": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "object",
            "additionalProperties": false,
            "required": ["id"],
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "model": { "type": "string" },
              "providerID": { "type": "string" },
              "purpose": { "type": "string" },
              "whenToUse": { "type": "string" },
              "systemPrompt": { "type": "string" },
              "port": { "type": "number" },
              "supportsVision": { "type": "boolean" },
              "supportsWeb": { "type": "boolean" },
              "temperature": { "type": "number" },
              "tags": { "type": "array", "items": { "type": "string" } },
              "extends": { "type": "string" },
              "compose": { "type": "array", "items": { "type": "string" } },
              "tools": {
                "type": "object",
                "additionalProperties": { "type": "boolean" }
              },
              "permissions": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "categories": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "filesystem": { "type": "string", "enum": ["full", "read", "none"] },
                      "execution": { "type": "string", "enum": ["full", "sandboxed", "none"] },
                      "network": { "type": "string", "enum": ["full", "localhost", "none"] }
                    }
                  },
                  "tools": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "object",
                      "additionalProperties": false,
                      "required": ["enabled"],
                      "properties": {
                        "enabled": { "type": "boolean" },
                        "constraints": { "type": "object" }
                      }
                    }
                  },
                  "paths": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "allowed": { "type": "array", "items": { "type": "string" } },
                      "denied": { "type": "array", "items": { "type": "string" } }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    },
    "workers": {
      "type": "array",
      "description": "Workers to auto-spawn. Items may be built-in IDs (string) or full profile objects.",
      "items": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "object",
            "additionalProperties": false,
            "required": ["id"],
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "model": { "type": "string" },
              "providerID": { "type": "string" },
              "purpose": { "type": "string" },
              "whenToUse": { "type": "string" },
              "systemPrompt": { "type": "string" },
              "port": { "type": "number" },
              "supportsVision": { "type": "boolean" },
              "supportsWeb": { "type": "boolean" },
              "temperature": { "type": "number" },
              "tags": { "type": "array", "items": { "type": "string" } },
              "extends": { "type": "string" },
              "compose": { "type": "array", "items": { "type": "string" } },
              "tools": {
                "type": "object",
                "additionalProperties": { "type": "boolean" }
              },
              "permissions": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "categories": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "filesystem": { "type": "string", "enum": ["full", "read", "none"] },
                      "execution": { "type": "string", "enum": ["full", "sandboxed", "none"] },
                      "network": { "type": "string", "enum": ["full", "localhost", "none"] }
                    }
                  },
                  "tools": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "object",
                      "additionalProperties": false,
                      "required": ["enabled"],
                      "properties": {
                        "enabled": { "type": "boolean" },
                        "constraints": { "type": "object" }
                      }
                    }
                  },
                  "paths": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "allowed": { "type": "array", "items": { "type": "string" } },
                      "denied": { "type": "array", "items": { "type": "string" } }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    }
  }
}
